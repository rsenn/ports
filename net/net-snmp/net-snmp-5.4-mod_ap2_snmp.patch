diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/ap2_snmp.h net-snmp-5.4/agent/mibgroup/ap2_snmp.h
--- net-snmp-5.4_orig/agent/mibgroup/ap2_snmp.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/ap2_snmp.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,27 @@
+config_require(apache2/serverName)
+config_require(apache2/serverRestart)
+config_require(apache2/serverBuilt)
+config_require(apache2/serverVersion)
+config_require(apache2/serverPidfile)
+config_require(apache2/serverRoot)
+config_require(apache2/serverTmpDir)
+config_require(apache2/agentHttpAccess)
+config_require(apache2/serverUptime)
+config_require(apache2/agentHttpAddress)
+config_require(apache2/totalServerPorts)
+config_require(apache2/serverListenPorts)
+config_require(apache2/totalAccess)
+config_require(apache2/serverStatus)
+config_require(apache2/totalTraffic)
+config_require(apache2/busyWorkers)
+config_require(apache2/idleWorkers)
+config_require(apache2/httpError400)
+config_require(apache2/httpError403)
+config_require(apache2/httpError404)
+config_require(apache2/httpError405)
+config_require(apache2/httpError500)
+config_require(apache2/httpError501)
+config_require(apache2/httpError505)
+config_require(apache2/serverRequestsPerSec)
+config_require(apache2/serverKBytesPerSec)
+config_require(apache2/serverKBytesPerRequest)
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/agentHttpAccess.c net-snmp-5.4/agent/mibgroup/apache2/agentHttpAccess.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/agentHttpAccess.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/agentHttpAccess.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,48 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "agentHttpAccess.h"
+#include "module_init.h"
+
+/** Initializes the agentHttpAccess module */
+int agentHttpAccess = 0;
+
+void
+init_agentHttpAccess(void)
+{
+    static oid      agentHttpAccess_oid[] =
+        {MOD_SNMP_OID 2, 7 };
+
+    DEBUGMSGTL(("agentHttpAccess", "Initializing\n"));
+
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "agentHttpAccess", 
+            NULL,
+            agentHttpAccess_oid,
+            OID_LENGTH(agentHttpAccess_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &agentHttpAccess, sizeof(agentHttpAccess),
+            ASN_COUNTER, WATCHER_MAX_SIZE)
+        );                             
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/agentHttpAccess.h net-snmp-5.4/agent/mibgroup/apache2/agentHttpAccess.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/agentHttpAccess.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/agentHttpAccess.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,13 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef AGENTHTTPACCESS_H
+#define AGENTHTTPACCESS_H
+
+/*
+ * function declarations 
+ */
+void            init_agentHttpAccess(void);
+
+#endif                          /* AGENTHTTPACCESS_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/agentHttpAddress.c net-snmp-5.4/agent/mibgroup/apache2/agentHttpAddress.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/agentHttpAddress.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/agentHttpAddress.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,53 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "agentHttpAddress.h"
+#include "module_init.h"
+
+/** Initializes the agentHttpAddress module */
+char agentHttpAddress_str[MY_MAX_LEN];
+
+void
+init_agentHttpAddress(void)
+{
+    static oid      agentHttpAddress_oid[] =
+        { MOD_SNMP_OID 1, 8 };
+
+    DEBUGMSGTL(("agentHttpAddress", "Initializing\n"));
+    
+    
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "agentHttpAddress", 
+            NULL,
+            agentHttpAddress_oid,
+            OID_LENGTH(agentHttpAddress_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &agentHttpAddress_str, sizeof(agentHttpAddress_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );                             
+    
+
+
+}
+
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/agentHttpAddress.h net-snmp-5.4/agent/mibgroup/apache2/agentHttpAddress.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/agentHttpAddress.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/agentHttpAddress.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,13 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef AGENTHTTPADDRESS_H
+#define AGENTHTTPADDRESS_H
+
+/*
+ * function declarations 
+ */
+void            	init_agentHttpAddress(void);
+
+#endif                          /* AGENTHTTPADDRESS_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/busyWorkers.c net-snmp-5.4/agent/mibgroup/apache2/busyWorkers.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/busyWorkers.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/busyWorkers.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,145 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "busyWorkers.h"
+#include "module_init.h"
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+static unsigned int      busyWorkers = 0;        /* XXX: set default value */
+extern char serverTmpDir_str[MY_MAX_LEN];	 // interchange file
+
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_busyWorkers(void)
+{
+    static oid      busyWorkers_oid[] =
+        {MOD_SNMP_OID 2, 3 };
+
+    /*
+     * a debugging statement.  Run the agent with -DbusyWorkers to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("busyWorkers", "Initializing the busyWorkers module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+    DEBUGMSGTL(("busyWorkers",
+                "Initializing busyWorkers scalar integer.  Default value = %d\n",
+                busyWorkers));
+
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "busyWorkers", 
+            handler_busyWorkers,
+            busyWorkers_oid,
+            OID_LENGTH(busyWorkers_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &busyWorkers, sizeof(busyWorkers),
+            ASN_GAUGE, WATCHER_MAX_SIZE)
+        );
+
+
+    DEBUGMSGTL(("busyWorkers", "Done initalizing busyWorkers module\n"));
+}
+
+
+int
+handler_busyWorkers(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+	// 22/07/04 - EP - don´t need call check_estado here
+	//	if (check_estado())		// si Apache está ejecutándose..
+	//	{
+	//		int x;
+	//		DEBUGMSGTL(("busyWorkers", "send_http_get -->\n"));
+	if (send_http_get("/ap2_snmp"))
+	{
+		FILE *fp;	// archivo de intercambio
+	//    	DEBUGMSGTL(("busyWorkers","send_http_get.  valor= %d\n",x));
+    		 if ((fp = fopen(serverTmpDir_str,"r")) == NULL)
+			{
+				DEBUGMSGTL(("busyWorkers", "cannot open temporal file."));
+			}
+		 else
+		 	{
+				DEBUGMSGTL(("busyWorkers", "Reading data from temporal file."));
+				rewind(fp);
+			 	fseek(fp,2*sizeof(unsigned long),SEEK_SET);
+			 	fread(&busyWorkers,sizeof(unsigned long),1,fp);
+				fclose(fp);
+							
+		    		snmp_set_var_typed_value(requests->requestvb, ASN_GAUGE,
+			                        	(u_char *)
+			                        	&busyWorkers
+			                        	,
+			                        	sizeof(busyWorkers)
+			                        	);
+		 	}
+	}
+        break;
+    case MODE_SET_RESERVE1:
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        break;
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        /*
+         * we should never get here, so this is a really bad error 
+         */
+        return SNMP_ERR_GENERR;
+    }
+    return SNMP_ERR_NOERROR;
+}
+
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/busyWorkers.h net-snmp-5.4/agent/mibgroup/apache2/busyWorkers.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/busyWorkers.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/busyWorkers.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef BUSYWORKERS_H
+#define BUSYWORKERS_H
+
+/*
+ * function declarations 
+ */
+void            	init_busyWorkers(void);
+Netsnmp_Node_Handler 	handler_busyWorkers;
+
+#endif                          /* TOTALACCESS_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError400.c net-snmp-5.4/agent/mibgroup/apache2/httpError400.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError400.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError400.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,96 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include "httpError400.h"
+#include "module_init.h"
+
+/** Initializes the httpError400 module */
+static int httpError400 = 0;
+
+void
+init_httpError400(void)
+{
+    static oid      httpError400_oid[] =
+        { MOD_SNMP_OID 5, 400 };
+
+    DEBUGMSGTL(("httpError400", "Initializing\n"));
+
+    netsnmp_register_scalar(netsnmp_create_handler_registration
+                            ("httpError400", handle_httpError400,
+                             httpError400_oid,
+                             OID_LENGTH(httpError400_oid),
+                             HANDLER_CAN_RWRITE));
+}
+
+int
+handle_httpError400(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+    /*
+     * We are never called for a GETNEXT if it's registered as a
+     * "instance", as it's "magically" handled for us.  
+     */
+
+    /*
+     * a instance handler also only hands us one request at a time, so
+     * we don't need to loop over a list of requests; we'll only get one. 
+     */
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+        snmp_set_var_typed_value(requests->requestvb, ASN_COUNTER,
+                                 (u_char *)
+                                 &httpError400                                
+                                 ,
+                                 sizeof(httpError400)
+                                 );
+        break;
+
+    case MODE_SET_RESERVE1:
+        //if (requests->requestvb->type != ASN_COUNTER ) {
+	httpError400++;                                   
+        //}
+        break;
+
+    case MODE_SET_RESERVE2:
+        break;
+
+    case MODE_SET_FREE:
+        break;
+
+    case MODE_SET_ACTION:
+        break;
+
+    case MODE_SET_COMMIT:
+        break;
+
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError400.h net-snmp-5.4/agent/mibgroup/apache2/httpError400.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError400.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError400.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef HTTPERROR400_H
+#define HTTPERROR400_H
+
+/*
+ * function declarations 
+ */
+void            init_httpError400(void);
+Netsnmp_Node_Handler handle_httpError400;
+
+#endif                          /* HTTPERROR400_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError403.c net-snmp-5.4/agent/mibgroup/apache2/httpError403.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError403.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError403.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,87 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include "httpError403.h"
+#include "module_init.h"
+
+/** Initializes the httpError403 module */
+static int httpError403 = 0;
+
+void
+init_httpError403(void)
+{
+    static oid      httpError403_oid[] =
+        { MOD_SNMP_OID 5, 403 };
+
+    DEBUGMSGTL(("httpError403", "Initializing\n"));
+
+    netsnmp_register_scalar(netsnmp_create_handler_registration
+                            ("httpError403", handle_httpError403,
+                             httpError403_oid,
+                             OID_LENGTH(httpError403_oid),
+                             HANDLER_CAN_RWRITE));
+}
+
+int
+handle_httpError403(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+        snmp_set_var_typed_value(requests->requestvb, ASN_COUNTER,
+                                 (u_char *)
+                                 &httpError403                                
+                                 ,
+                                 sizeof(httpError403)
+                                 );
+        break;
+
+    case MODE_SET_RESERVE1:
+        //if (requests->requestvb->type != ASN_COUNTER ) {
+		   httpError403++;                                   
+        //}
+        break;
+
+    case MODE_SET_RESERVE2:
+        break;
+
+    case MODE_SET_FREE:
+        break;
+
+    case MODE_SET_ACTION:
+        break;
+
+    case MODE_SET_COMMIT:
+        break;
+
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError403.h net-snmp-5.4/agent/mibgroup/apache2/httpError403.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError403.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError403.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef HTTPERROR403_H
+#define HTTPERROR403_H
+
+/*
+ * function declarations 
+ */
+void            init_httpError403(void);
+Netsnmp_Node_Handler handle_httpError403;
+
+#endif                          /* HTTPERROR400_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError404.c net-snmp-5.4/agent/mibgroup/apache2/httpError404.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError404.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError404.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,102 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include "httpError404.h"
+#include "module_init.h"
+
+/** Initializes the httpError404 module */
+static int httpError404 = 0;
+
+void
+init_httpError404(void)
+{
+    static oid      httpError404_oid[] =
+        { MOD_SNMP_OID 5, 404 };
+
+    DEBUGMSGTL(("httpError404", "Initializing\n"));
+
+    netsnmp_register_scalar(netsnmp_create_handler_registration
+                            ("httpError404", handle_httpError404,
+                             httpError404_oid,
+                             OID_LENGTH(httpError404_oid),
+                             HANDLER_CAN_RWRITE));
+}
+
+int
+handle_httpError404(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+    /*
+     * We are never called for a GETNEXT if it's registered as a
+     * "instance", as it's "magically" handled for us.  
+     */
+
+    /*
+     * a instance handler also only hands us one request at a time, so
+     * we don't need to loop over a list of requests; we'll only get one. 
+     */
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+        snmp_set_var_typed_value(requests->requestvb, ASN_COUNTER,
+                                 (u_char *)
+                                 &httpError404                                
+                                 ,
+                                 sizeof(httpError404)
+                                 );
+        break;
+
+        /*
+         * SET REQUEST
+         *
+         * multiple states in the transaction.  See:
+         * http://www.net-snmp.org/tutorial-5/toolkit/mib_module/set-actions.jpg
+         */
+    case MODE_SET_RESERVE1:
+        //if (requests->requestvb->type != ASN_COUNTER ) {
+		   httpError404++;                                   
+        //}
+        break;
+
+    case MODE_SET_RESERVE2:
+        break;
+
+    case MODE_SET_FREE:
+        break;
+
+    case MODE_SET_ACTION:
+        break;
+
+    case MODE_SET_COMMIT:
+        break;
+
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError404.h net-snmp-5.4/agent/mibgroup/apache2/httpError404.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError404.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError404.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef HTTPERROR404_H
+#define HTTPERROR404_H
+
+/*
+ * function declarations 
+ */
+void            init_httpError404(void);
+Netsnmp_Node_Handler handle_httpError404;
+
+#endif                          /* HTTPERROR404_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError405.c net-snmp-5.4/agent/mibgroup/apache2/httpError405.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError405.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError405.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,87 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include "httpError405.h"
+#include "module_init.h"
+
+/** Initializes the httpError405 module */
+static int httpError405 = 0;
+
+void
+init_httpError405(void)
+{
+    static oid      httpError405_oid[] =
+        { MOD_SNMP_OID 5, 405 };
+
+    DEBUGMSGTL(("httpError405", "Initializing\n"));
+
+    netsnmp_register_scalar(netsnmp_create_handler_registration
+                            ("httpError405", handle_httpError405,
+                             httpError405_oid,
+                             OID_LENGTH(httpError405_oid),
+                             HANDLER_CAN_RWRITE));
+}
+
+int
+handle_httpError405(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+        snmp_set_var_typed_value(requests->requestvb, ASN_COUNTER,
+                                 (u_char *)
+                                 &httpError405                                
+                                 ,
+                                 sizeof(httpError405)
+                                 );
+        break;
+
+    case MODE_SET_RESERVE1:
+        //if (requests->requestvb->type != ASN_COUNTER ) {
+		   httpError405++;                                   
+        //}
+        break;
+
+    case MODE_SET_RESERVE2:
+        break;
+
+    case MODE_SET_FREE:
+        break;
+
+    case MODE_SET_ACTION:
+        break;
+
+    case MODE_SET_COMMIT:
+        break;
+
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError405.h net-snmp-5.4/agent/mibgroup/apache2/httpError405.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError405.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError405.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef HTTPERROR405_H
+#define HTTPERROR405_H
+
+/*
+ * function declarations 
+ */
+void            init_httpError405(void);
+Netsnmp_Node_Handler handle_httpError405;
+
+#endif                          /* HTTPERROR400_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError500.c net-snmp-5.4/agent/mibgroup/apache2/httpError500.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError500.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError500.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,87 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include "httpError500.h"
+#include "module_init.h"
+
+/** Initializes the httpError500 module */
+static int httpError500 = 0;
+
+void
+init_httpError500(void)
+{
+    static oid      httpError500_oid[] =
+        { MOD_SNMP_OID 5, 500 };
+
+    DEBUGMSGTL(("httpError500", "Initializing\n"));
+
+    netsnmp_register_scalar(netsnmp_create_handler_registration
+                            ("httpError500", handle_httpError500,
+                             httpError500_oid,
+                             OID_LENGTH(httpError500_oid),
+                             HANDLER_CAN_RWRITE));
+}
+
+int
+handle_httpError500(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+        snmp_set_var_typed_value(requests->requestvb, ASN_COUNTER,
+                                 (u_char *)
+                                 &httpError500                                
+                                 ,
+                                 sizeof(httpError500)
+                                 );
+        break;
+
+    case MODE_SET_RESERVE1:
+        //if (requests->requestvb->type != ASN_COUNTER ) {
+		   httpError500++;                                   
+        //}
+        break;
+
+    case MODE_SET_RESERVE2:
+        break;
+
+    case MODE_SET_FREE:
+        break;
+
+    case MODE_SET_ACTION:
+        break;
+
+    case MODE_SET_COMMIT:
+        break;
+
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError500.h net-snmp-5.4/agent/mibgroup/apache2/httpError500.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError500.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError500.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef HTTPERROR500_H
+#define HTTPERROR500_H
+
+/*
+ * function declarations 
+ */
+void            init_httpError500(void);
+Netsnmp_Node_Handler handle_httpError500;
+
+#endif                          /* HTTPERROR500_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError501.c net-snmp-5.4/agent/mibgroup/apache2/httpError501.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError501.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError501.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,87 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include "httpError501.h"
+#include "module_init.h"
+
+/** Initializes the httpError501 module */
+static int httpError501 = 0;
+
+void
+init_httpError501(void)
+{
+    static oid      httpError501_oid[] =
+        { MOD_SNMP_OID 5, 501 };
+
+    DEBUGMSGTL(("httpError501", "Initializing\n"));
+
+    netsnmp_register_scalar(netsnmp_create_handler_registration
+                            ("httpError501", handle_httpError501,
+                             httpError501_oid,
+                             OID_LENGTH(httpError501_oid),
+                             HANDLER_CAN_RWRITE));
+}
+
+int
+handle_httpError501(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+        snmp_set_var_typed_value(requests->requestvb, ASN_COUNTER,
+                                 (u_char *)
+                                 &httpError501                                
+                                 ,
+                                 sizeof(httpError501)
+                                 );
+        break;
+
+    case MODE_SET_RESERVE1:
+        //if (requests->requestvb->type != ASN_COUNTER ) {
+		   httpError501++;                                   
+        //}
+        break;
+
+    case MODE_SET_RESERVE2:
+        break;
+
+    case MODE_SET_FREE:
+        break;
+
+    case MODE_SET_ACTION:
+        break;
+
+    case MODE_SET_COMMIT:
+        break;
+
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError501.h net-snmp-5.4/agent/mibgroup/apache2/httpError501.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError501.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError501.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef HTTPERROR501_H
+#define HTTPERROR501_H
+
+/*
+ * function declarations 
+ */
+void            init_httpError501(void);
+Netsnmp_Node_Handler handle_httpError501;
+
+#endif                          /* HTTPERROR501_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError505.c net-snmp-5.4/agent/mibgroup/apache2/httpError505.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError505.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError505.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,87 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include "httpError505.h"
+#include "module_init.h"
+
+/** Initializes the httpError505 module */
+static int httpError505 = 0;
+
+void
+init_httpError505(void)
+{
+    static oid      httpError505_oid[] =
+        { MOD_SNMP_OID 5, 505 };
+
+    DEBUGMSGTL(("httpError505", "Initializing\n"));
+
+    netsnmp_register_scalar(netsnmp_create_handler_registration
+                            ("httpError505", handle_httpError505,
+                             httpError505_oid,
+                             OID_LENGTH(httpError505_oid),
+                             HANDLER_CAN_RWRITE));
+}
+
+int
+handle_httpError505(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+        snmp_set_var_typed_value(requests->requestvb, ASN_COUNTER,
+                                 (u_char *)
+                                 &httpError505                                
+                                 ,
+                                 sizeof(httpError505)
+                                 );
+        break;
+
+    case MODE_SET_RESERVE1:
+        //if (requests->requestvb->type != ASN_COUNTER ) {
+		   httpError505++;                                   
+        //}
+        break;
+
+    case MODE_SET_RESERVE2:
+        break;
+
+    case MODE_SET_FREE:
+        break;
+
+    case MODE_SET_ACTION:
+        break;
+
+    case MODE_SET_COMMIT:
+        break;
+
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/httpError505.h net-snmp-5.4/agent/mibgroup/apache2/httpError505.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/httpError505.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/httpError505.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef HTTPERROR505_H
+#define HTTPERROR505_H
+
+/*
+ * function declarations 
+ */
+void            init_httpError505(void);
+Netsnmp_Node_Handler handle_httpError505;
+
+#endif                          /* HTTPERROR505_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/idleWorkers.c net-snmp-5.4/agent/mibgroup/apache2/idleWorkers.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/idleWorkers.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/idleWorkers.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,145 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "idleWorkers.h"
+#include "module_init.h"
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+static unsigned int      idleWorkers = 0;        /* XXX: set default value */
+extern char serverTmpDir_str[MY_MAX_LEN];	 // archivo de intercambio
+
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_idleWorkers(void)
+{
+    static oid      idleWorkers_oid[] =
+        { MOD_SNMP_OID 2, 4 };
+
+    /*
+     * a debugging statement.  Run the agent with -DidleWorkers to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("idleWorkers", "Initializing the idleWorkers module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+    DEBUGMSGTL(("idleWorkers",
+                "Initializing idleWorkers scalar integer.  Default value = %d\n",
+                idleWorkers));
+
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "idleWorkers", 
+            handler_idleWorkers,
+            idleWorkers_oid,
+            OID_LENGTH(idleWorkers_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &idleWorkers, sizeof(idleWorkers),
+            ASN_GAUGE, WATCHER_MAX_SIZE)
+        );
+
+
+    DEBUGMSGTL(("idleWorkers", "Done initalizing idleWorkers module\n"));
+}
+
+
+int
+handler_idleWorkers(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+	// 22/07/04 - EP - don´t need call check_estado here
+	//	if (check_estado())		// si Apache está ejecutándose..
+	//	{
+	//		int x;
+	//		DEBUGMSGTL(("idleWorkers", "send_http_get -->\n"));
+	if (send_http_get("/ap2_snmp"))
+	{ 	
+		FILE *fp;	// archivo de intercambio
+	//    		DEBUGMSGTL(("idleWorkers","send_http_get.  valor= %d\n",x));
+    		 if ((fp = fopen(serverTmpDir_str,"r")) == NULL)
+			{
+				DEBUGMSGTL(("idleWorkers", "cannot open temporal file."));
+			}
+		 else
+		 	{
+				DEBUGMSGTL(("idleWorkers", "Reading data from temporal file."));
+				rewind(fp);
+			 	fseek(fp,2*sizeof(unsigned long)+sizeof(int),SEEK_SET);
+			 	fread(&idleWorkers,sizeof(unsigned long),1,fp);
+				fclose(fp);
+							
+		    		snmp_set_var_typed_value(requests->requestvb, ASN_GAUGE,
+			                        	(u_char *)
+			                        	&idleWorkers
+			                        	,
+			                        	sizeof(idleWorkers)
+			                        	);
+		 	}
+	}
+        break;
+    case MODE_SET_RESERVE1:
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        break;
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        /*
+         * we should never get here, so this is a really bad error 
+         */
+        return SNMP_ERR_GENERR;
+    }
+    return SNMP_ERR_NOERROR;
+}
+
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/idleWorkers.h net-snmp-5.4/agent/mibgroup/apache2/idleWorkers.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/idleWorkers.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/idleWorkers.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef IDLEWORKERS_H
+#define IDLEWORKERS_H
+
+/*
+ * function declarations 
+ */
+void            	init_idleWorkers(void);
+Netsnmp_Node_Handler 	handler_idleWorkers;
+
+#endif                          /* TOTALACCESS_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/module_init.h net-snmp-5.4/agent/mibgroup/apache2/module_init.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/module_init.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/module_init.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,17 @@
+// Object Identificator base..
+#define MOD_SNMP_OID  1, 3, 6, 1, 4, 1, 19786, 1, 1,
+#define NOTIFICATION_OID 1, 3, 6, 1, 6, 3, 1, 1, 4, 1, 0
+#define MY_MAX_LEN 254
+
+// HTTP request
+#define MAX_RECEIVE 512
+#define MAX_SEND 512
+#define DEFAULT_PORT 443
+#define DEFAULT_ADDRESS "127.0.0.1"
+
+// Server Status
+#define SERVER_DOWN		0
+#define SERVER_UP		1
+#define SERVER_NOT_RESPONDING	2
+#define SERVER_STARTING 	3
+#define SERVER_SHUTTING_DOWN	4
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/notifApacheStatus.c net-snmp-5.4/agent/mibgroup/apache2/notifApacheStatus.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/notifApacheStatus.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/notifApacheStatus.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,127 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+/*
+ * start be including the appropriate header files 
+ */
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+
+/*
+ * contains prototypes 
+ */
+#include "notifApacheStatus.h"
+
+extern char serverRestart_str[MY_MAX_LEN];
+/*
+ * our initialization routine
+ * (to get called, the function name must match init_FILENAME() 
+ */
+void
+init_notifApacheStatus(void)
+{
+    DEBUGMSGTL(("notifApacheStatus",
+                "initializing (setting callback alarm)\n"));
+    snmp_alarm_register(30,     /* seconds */
+                        SA_REPEAT,      /* repeat (every 30 seconds). */
+                        send_example_notifApacheStatus,      /* our callback */
+                        NULL    /* no callback data needed */
+        );
+}
+
+/** here we send a SNMP v2 trap (which can be sent through snmpv3 and
+ *  snmpv1 as well) and send it out.
+ *
+ *     The various "send_trap()" calls allow you to specify traps in different
+ *  formats.  And the various "trapsink" directives allow you to specify
+ *  destinations to receive different formats.
+ *  But *all* traps are sent to *all* destinations, regardless of how they
+ *  were specified.
+ *  
+ *  
+ *  I.e. it's
+ *                                           ___  trapsink
+ *                                          /
+ *      send_easy_trap \___  [  Trap      ] ____  trap2sink
+ *                      ___  [ Generator  ]
+ *      send_v2trap    /     [            ] ----- informsink
+ *                                          \____
+ *                                                trapsess
+ *  
+ *  *Not*
+ *       send_easy_trap  ------------------->  trapsink
+ *       send_v2trap     ------------------->  trap2sink
+ *       ????            ------------------->  informsink
+ *       ????            ------------------->  trapsess
+ */
+void
+send_example_notifApacheStatus(unsigned int clientreg, void *clientarg)
+{
+
+    /*
+     * In the notifApacheStatus, we have to assign our notifApacheStatus OID to
+     * the snmpTrapOID.0 object. Here is it's definition. 
+     */
+    /* OID snmpTrapOID.0 object */
+    oid             objid_snmptrap[] = { 1, 3, 6, 1, 6, 3, 1, 1, 4, 1, 0 };
+    size_t          objid_snmptrap_len = OID_LENGTH(objid_snmptrap);
+
+    oid             notifApacheStatus_oid[] = { 1, 3, 6, 1, 4, 1, 19786, 1, 1, 4, 1 };
+    size_t          notifApacheStatus_oid_len = OID_LENGTH(notifApacheStatus_oid);
+    
+    oid             example_string_oid[] = {1, 3, 6, 1, 4, 1, 19786, 1, 1, 1 , 6 };
+    
+    /*
+     * here is where we store the variables to be sent in the trap 
+     */
+    netsnmp_variable_list *notifApacheStatus_vars = NULL;
+
+    DEBUGMSGTL(("notifApacheStatus", "defining the trap\n"));
+
+
+    snmp_varlist_add_variable(&notifApacheStatus_vars,
+                              objid_snmptrap, objid_snmptrap_len,
+                              ASN_OBJECT_ID,
+                              (u_char *) notifApacheStatus_oid,
+                              notifApacheStatus_oid_len * sizeof(oid));
+
+    /*
+     * if we wanted to insert additional objects, we'd do it here 
+     */
+    snmp_varlist_add_variable(&notifApacheStatus_vars,
+                              notifApacheStatus_oid, notifApacheStatus_oid_len,
+                              ASN_OCTET_STR,
+                              (u_char *) serverRestart_str,
+                              strlen(serverRestart_str));
+
+
+    /*
+     * send the trap out.  This will send it to all registered
+     * receivers (see the "SETTING UP TRAP AND/OR INFORM DESTINATIONS"
+     * section of the snmpd.conf manual page. 
+     */
+    DEBUGMSGTL(("notifApacheStatus", "sending the trap\n"));
+    send_v2trap(notifApacheStatus_vars);
+
+    /*
+     * free the created notifApacheStatus variable list 
+     */
+    DEBUGMSGTL(("notifApacheStatus", "cleaning up\n"));
+    snmp_free_varbind(notifApacheStatus_vars);
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/notifApacheStatus.h net-snmp-5.4/agent/mibgroup/apache2/notifApacheStatus.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/notifApacheStatus.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/notifApacheStatus.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,8 @@
+#ifndef NOTIFAPACHESTATUS_H
+#define NOTIFAPACHESTATUS_H
+
+/* prototypes for the example */
+void init_notifApacheStatus(void);
+SNMPAlarmCallback send_example_notifApacheStatus;
+
+#endif /* NOTIFICATION_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/send_http.c net-snmp-5.4/agent/mibgroup/apache2/send_http.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/send_http.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/send_http.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,83 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+int send_http_to_local (char* ip, char* port, char* location)
+{
+	int sockfd;
+	char caracter;
+	char linea_send [512];
+	char linea_recv [512];
+	int rcv_bytes;
+
+// conexion
+	struct sockaddr_in serv_addr;
+
+	bzero( (char *) &serv_addr, sizeof(serv_addr));
+	serv_addr.sin_family = AF_INET;
+	serv_addr.sin_addr.s_addr = inet_addr(ip);	// direccion IP
+	serv_addr.sin_port = htons(port);		// puerto
+
+	/* Opens TCP socket */
+	if ( ( sockfd = socket( AF_INET, SOCK_STREAM, 0) ) < 0 )
+	{
+		perror( "client: socket() Error\n");
+		return -1;
+	}
+
+	/* Connects */
+	if ( connect (sockfd, (struct sockaddr *) &serv_addr, sizeof(serv_addr)) < 0 )
+	{
+		close(sockfd); // close connection
+		perror("client: connect() Error \n");
+		return -1;
+	}
+
+
+//	printf("Conectado...\n");
+
+	strcpy(linea_recv,"");
+	strcpy(linea_send,"GET /test-loc");
+
+		if ( strlen(linea_send) > 0)
+		{
+			//printf("Send.. %s",linea_send);
+			send( sockfd, linea_send, MAX_SEND, 0);
+			strcpy(linea_recv,"");
+			rcv_bytes = recv( sockfd, linea_recv, MAX_RECEIVE , 0);
+
+			if (rcv_bytes > 0)
+				{
+					linea_recv[rcv_bytes] = '\0';
+		 			if (strcmp(linea_recv,"OK")==0)
+		 				printf("OK");
+		 				return 1;	// 	OK
+		 			else
+		 			{
+		 				printf("Error..");
+		 				return 0;	//	error
+		 			}
+				}
+			else
+			{
+				printf("Sin recepcion..");
+				return 0;	//	error
+			}
+		}
+		else
+			return 0;	//	error
+}
\ No newline at end of file
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverBuilt.c net-snmp-5.4/agent/mibgroup/apache2/serverBuilt.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverBuilt.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverBuilt.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,72 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverBuilt.h"
+#include "module_init.h"
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+static char serverBuilt_str[MY_MAX_LEN];
+
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_serverBuilt(void)
+{
+
+    /*
+     * a debugging statement.  Run the agent with -DserverBuilt to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("serverBuilt", "Initializing the serverBuilt module\n"));
+   static oid      serverBuilt_oid[] =
+        {MOD_SNMP_OID 1 , 3};
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverBuilt", 
+            NULL,
+            serverBuilt_oid,
+            OID_LENGTH(serverBuilt_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverBuilt_str, sizeof(serverBuilt_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+    DEBUGMSGTL(("serverBuilt", "Done initalizing serverBuilt module\n"));
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverBuilt.h net-snmp-5.4/agent/mibgroup/apache2/serverBuilt.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverBuilt.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverBuilt.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,13 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERBUILT_H
+#define SERVERBUILT_H
+
+/*
+ * function declarations 
+ */
+void            init_serverBuilt(void);
+
+#endif                          /* SERVERBUILT_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverHostName.c net-snmp-5.4/agent/mibgroup/apache2/serverHostName.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverHostName.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverHostName.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,75 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverHostName.h"
+#include "module_init.h"
+
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+char serverHostName_str[MY_MAX_LEN];
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_serverHostName(void)
+{
+   static oid      serverHostName_oid[] =
+        { MOD_SNMP_OID 1 , 9};
+
+    /*
+     * a debugging statement.  Run the agent with -DserverHostName to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("serverHostName", "Initializing the serverHostName module\n"));
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverHostName", 
+            NULL,
+            serverHostName_oid,
+            OID_LENGTH(serverHostName_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverHostName_str, sizeof(serverHostName_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+
+    DEBUGMSGTL(("serverHostName", "Done initalizing serverHostName module\n"));
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverHostName.h net-snmp-5.4/agent/mibgroup/apache2/serverHostName.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverHostName.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverHostName.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,13 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERHOSTNAME_H
+#define SERVERHOSTNAME_H
+
+/*
+ * function declarations 
+ */
+void            init_serverHostName(void);
+
+#endif                          /* SERVERHOSTNAME_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverKBytesPerRequest.c net-snmp-5.4/agent/mibgroup/apache2/serverKBytesPerRequest.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverKBytesPerRequest.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverKBytesPerRequest.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,145 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverKBytesPerRequest.h"
+#include "module_init.h"
+
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+static char serverKBytesPerRequest_str[MY_MAX_LEN];       	/* Init serverKBytesPerRequest */
+
+extern char serverTmpDir_str[MY_MAX_LEN];	 	/* interchange file*/
+
+/*
+ * our initialization routine, automatically called by the agent
+ * (to get called, the function name must match init_FILENAME())
+ */
+void
+init_serverKBytesPerRequest(void)
+{
+    static oid      serverKBytesPerRequest_oid[] =
+        { MOD_SNMP_OID 2, 10 };
+
+    /*
+     * a debugging statement.  Run the agent with -DserverKBytesPerRequest to see
+     * the output of this debugging statement.
+     */
+    DEBUGMSGTL(("serverKBytesPerRequest", "Initializing the serverKBytesPerRequest module\n"));
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     *
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function.
+     */
+    DEBUGMSGTL(("serverKBytesPerRequest",
+                "Initializing serverKBytesPerRequest scalar integer.  Default value = %s\n",
+                serverKBytesPerRequest_str));
+
+     netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverKBytesPerRequest",
+            handler_serverKBytesPerRequest,
+            serverKBytesPerRequest_oid,
+            OID_LENGTH(serverKBytesPerRequest_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverKBytesPerRequest_str, sizeof(serverKBytesPerRequest_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+
+    DEBUGMSGTL(("serverKBytesPerRequest", "Done initalizing serverKBytesPerRequest module\n"));
+}
+
+
+int
+handler_serverKBytesPerRequest(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    // temp variable for reading tmp file.
+    float serverKBytesPerRequest_tmp = 0;
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+
+	if (send_http_get("/ap2_snmp"))
+	{
+		FILE *fp;	// interchange filehandler
+    		//DEBUGMSGTL(("serverKBytesPerRequest","send_http_get.  valor= %d\n",x));
+
+    		 if ((fp = fopen(serverTmpDir_str,"r")) == NULL)
+			{
+				DEBUGMSGTL(("serverKBytesPerRequest", "cannot open temporal file."));
+			}
+		 else
+		 	{
+				DEBUGMSGTL(("serverKBytesPerRequest", "Reading data from temporal file."));
+				rewind(fp);
+			 	fseek(fp,2*sizeof(unsigned long)+sizeof(int)*2+sizeof(float)*2,SEEK_SET);
+			 	fread(&serverKBytesPerRequest_tmp,sizeof(float),1,fp);
+				fclose(fp);
+
+				sprintf(serverKBytesPerRequest_str,"%f",serverKBytesPerRequest_tmp);
+
+				snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
+										(u_char *)
+										serverKBytesPerRequest_str
+										,
+										strlen(serverKBytesPerRequest_str)-1
+										);
+		 	}
+	}
+        break;
+    case MODE_SET_RESERVE1:
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        break;
+    case MODE_SET_UNDO:
+        break;
+    default:
+        /*
+         * we should never get here, so this is a really bad error
+         */
+        return SNMP_ERR_GENERR;
+    }
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverKBytesPerRequest.h net-snmp-5.4/agent/mibgroup/apache2/serverKBytesPerRequest.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverKBytesPerRequest.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverKBytesPerRequest.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERKBYTESPERREQUEST_H
+#define SERVERKBYTESPERREQUEST_H
+
+/*
+ * function declarations
+ */
+void            	init_serverKBytesPerRequest(void);
+Netsnmp_Node_Handler 	handler_serverKBytesPerRequest;
+
+#endif                          /* serverBytesPerRequest_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverKBytesPerSec.c net-snmp-5.4/agent/mibgroup/apache2/serverKBytesPerSec.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverKBytesPerSec.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverKBytesPerSec.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,145 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverKBytesPerSec.h"
+#include "module_init.h"
+
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+static char serverKBytesPerSec_str[MY_MAX_LEN];       	/* Init serverKBytesPerSec */
+
+extern char serverTmpDir_str[MY_MAX_LEN];	 	/* interchange file*/
+
+/*
+ * our initialization routine, automatically called by the agent
+ * (to get called, the function name must match init_FILENAME())
+ */
+void
+init_serverKBytesPerSec(void)
+{
+    static oid      serverKBytesPerSec_oid[] =
+        { MOD_SNMP_OID 2, 9 };
+
+    /*
+     * a debugging statement.  Run the agent with -DserverKBytesPerSec to see
+     * the output of this debugging statement.
+     */
+    DEBUGMSGTL(("serverKBytesPerSec", "Initializing the serverKBytesPerSec module\n"));
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     *
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function.
+     */
+    DEBUGMSGTL(("serverKBytesPerSec",
+                "Initializing serverKBytesPerSec scalar integer.  Default value = %s\n",
+                serverKBytesPerSec_str));
+
+     netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverKBytesPerSec",
+            handler_serverKBytesPerSec,
+            serverKBytesPerSec_oid,
+            OID_LENGTH(serverKBytesPerSec_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverKBytesPerSec_str, sizeof(serverKBytesPerSec_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+
+    DEBUGMSGTL(("serverKBytesPerSec", "Done initalizing serverKBytesPerSec module\n"));
+}
+
+
+int
+handler_serverKBytesPerSec(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    // temp variable for reading tmp file.
+    float serverKBytesPerSec_tmp = 0;
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+
+	if (send_http_get("/ap2_snmp"))
+	{
+		FILE *fp;	// interchange filehandler
+    		//DEBUGMSGTL(("serverKBytesPerSec","send_http_get.  valor= %d\n",x));
+
+    		 if ((fp = fopen(serverTmpDir_str,"r")) == NULL)
+			{
+				DEBUGMSGTL(("serverKBytesPerSec", "cannot open temporal file."));
+			}
+		 else
+		 	{
+				DEBUGMSGTL(("serverKBytesPerSec", "Reading data from temporal file."));
+				rewind(fp);
+			 	fseek(fp,2*sizeof(unsigned long)+sizeof(int)*2+sizeof(float),SEEK_SET);
+			 	fread(&serverKBytesPerSec_tmp,sizeof(float),1,fp);
+				fclose(fp);
+
+				sprintf(serverKBytesPerSec_str,"%f",serverKBytesPerSec_tmp);
+
+				snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
+										(u_char *)
+										serverKBytesPerSec_str
+										,
+										strlen(serverKBytesPerSec_str)-1
+										);
+		 	}
+	}
+        break;
+    case MODE_SET_RESERVE1:
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        break;
+    case MODE_SET_UNDO:
+        break;
+    default:
+        /*
+         * we should never get here, so this is a really bad error
+         */
+        return SNMP_ERR_GENERR;
+    }
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverKBytesPerSec.h net-snmp-5.4/agent/mibgroup/apache2/serverKBytesPerSec.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverKBytesPerSec.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverKBytesPerSec.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERKBYTESPERSEC_H
+#define SERVERKBYTESPERSEC_H
+
+/*
+ * function declarations
+ */
+void            	init_serverKBytesPerSec(void);
+Netsnmp_Node_Handler 	handler_serverKBytesPerSec;
+
+#endif                          /* serverBytesPerSec_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverListenPorts.c net-snmp-5.4/agent/mibgroup/apache2/serverListenPorts.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverListenPorts.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverListenPorts.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,120 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverListenPorts.h"
+#include "module_init.h"
+
+
+netsnmp_table_data_set *table_set;
+netsnmp_table_row *row;
+
+void
+init_serverListenPorts(void)
+{
+
+    //int col1,col2;
+    
+    /*col1 = 1;
+    col2 = 8080;*/
+    
+    oid my_registration_oid[] = {MOD_SNMP_OID 1, 10 };
+
+    DEBUGMSGTL(("serverListenPorts","Init serverListenPorts\n")); 
+ 
+
+    table_set = netsnmp_create_table_data_set("serverListenPorts");
+
+    /*
+     * allow the creation of new rows via SNMP SETs 
+     */
+    table_set->allow_creation = 1;
+
+    /*
+     * set up what a row "should" look like, starting with the index 
+     */
+    netsnmp_table_dataset_add_index(table_set, ASN_INTEGER);
+
+   /*
+     * define what the columns should look like.  both are octet strings here 
+     */
+    netsnmp_table_set_multi_add_default_row(table_set,
+                                            2, ASN_INTEGER, 1,NULL, 0,
+                                            0 /* done */ );
+ 
+    /*
+     * register the table 
+     */
+    /*
+     * if we wanted to handle specific data in a specific way, or note
+     * * when requests came in we could change the NULL below to a valid
+     * * handler method in which we could over ride the default
+     * * behaviour of the table_dataset helper 
+     */
+    netsnmp_register_table_data_set(netsnmp_create_handler_registration
+                                    ("serverListenPorts", NULL,
+                                     my_registration_oid,
+                                     OID_LENGTH(my_registration_oid),
+                                     HANDLER_CAN_RWRITE), table_set, NULL);
+
+    /*
+     * create the a row for the table, and add the data 
+     */
+    row = netsnmp_create_table_data_row();
+    /*
+     * set the index to the IETF WG name "snmpv3" 
+     */
+    /*netsnmp_table_row_add_index(row, ASN_INTEGER, &col1,
+                                sizeof(col1));
+*/
+
+    /*
+     * set column 2 to be the WG chair name "Russ Mundy" 
+     */
+//    netsnmp_set_row_column(row, 2, ASN_INTEGER, &col2, sizeof(col2));
+//    netsnmp_mark_row_column_writable(row, 2, 1);        /* make writable via SETs */
+
+    /*
+     * add the row to the table 
+     */
+/*    netsnmp_table_dataset_add_row(table_set, row);*/
+
+   
+//    DEBUGMSGTL(("example_data_set", "Done initializing.\n"));
+}
+
+
+void clean_table()
+{
+   netsnmp_table_row *row;
+   
+   DEBUGMSGTL(("serverListenPorts","Clean table\n"));
+    
+    if (!table_set->table)
+        return 0;
+
+    for (row = table_set->table->first_row; row; row = row->next) 
+    {
+        netsnmp_table_dataset_remove_and_delete_row(table_set,row);
+    }
+
+}
+
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverListenPorts.h net-snmp-5.4/agent/mibgroup/apache2/serverListenPorts.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverListenPorts.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverListenPorts.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef SERVERLISTENPORTS_H
+#define SERVERLISTENPORTS_H
+
+/*
+ * function declarations 
+ */
+void            init_serverListenPorts(void);
+void 		clean_table(void);
+Netsnmp_Node_Handler 	serverListenPorts_handler;
+#endif                          /* SERVERLISTENPORTS_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverName.c net-snmp-5.4/agent/mibgroup/apache2/serverName.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverName.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverName.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,85 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverName.h"
+#include "module_init.h"
+
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+char serverName_str[MY_MAX_LEN];
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_serverName(void)
+{
+   static oid      serverName_oid[] =
+        { MOD_SNMP_OID 1 , 1};
+
+/*strcpy(serverName_str, "myString Value" );*/
+        
+    /*
+     * a debugging statement.  Run the agent with -DserverName to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("serverName", "Initializing the serverName module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+/*
+   netsnmp_register_int_instance("serverName",
+                                  serverName_oid,
+                                  OID_LENGTH(serverName_oid),
+                                  &serverName, NULL);
+*/
+
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverName", 
+            NULL,
+            serverName_oid,
+            OID_LENGTH(serverName_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverName_str, sizeof(serverName_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+
+ 
+    DEBUGMSGTL(("serverName", "Done initalizing serverName module\n"));
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverName.h net-snmp-5.4/agent/mibgroup/apache2/serverName.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverName.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverName.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,13 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERNAME_H
+#define SERVERNAME_H
+
+/*
+ * function declarations 
+ */
+void            init_serverName(void);
+
+#endif                          /* SERVERNAME_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverPidfile.c net-snmp-5.4/agent/mibgroup/apache2/serverPidfile.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverPidfile.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverPidfile.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,76 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverPidfile.h"
+#include "module_init.h"
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+char serverPidfile_str[MY_MAX_LEN];
+
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_serverPidfile(void)
+{
+   static oid      serverPidfile_oid[] =
+        { MOD_SNMP_OID 1 , 6};
+    /*
+     * a debugging statement.  Run the agent with -DserverPidfile to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("serverPidfile",
+                "Initializing the serverPidfile module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+   netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverPidfile", 
+            NULL,
+            serverPidfile_oid,
+            OID_LENGTH(serverPidfile_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverPidfile_str, sizeof(serverPidfile_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+        
+
+    DEBUGMSGTL(("serverPidfile",
+                "Done initalizing serverPidfile module\n"));
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverPidfile.h net-snmp-5.4/agent/mibgroup/apache2/serverPidfile.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverPidfile.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverPidfile.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,13 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERPIDFILE_H
+#define SERVERPIDFILE_H
+
+/*
+ * function declarations 
+ */
+void            init_serverPidfile(void);
+
+#endif                          /* SERVERPIDFILE_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverRequestsPerSec.c net-snmp-5.4/agent/mibgroup/apache2/serverRequestsPerSec.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverRequestsPerSec.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverRequestsPerSec.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,149 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverRequestsPerSec.h"
+#include "module_init.h"
+
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+static char serverRequestsPerSec_str[MY_MAX_LEN];       	/* Init serverRequestsPerSec */
+
+extern char serverTmpDir_str[MY_MAX_LEN];	 	/* interchange file*/
+
+/*
+ * our initialization routine, automatically called by the agent
+ * (to get called, the function name must match init_FILENAME())
+ */
+void
+init_serverRequestsPerSec(void)
+{
+    static oid      serverRequestsPerSec_oid[] =
+        { MOD_SNMP_OID 2, 8 };
+
+    /*
+     * a debugging statement.  Run the agent with -DserverRequestsPerSec to see
+     * the output of this debugging statement.
+     */
+    DEBUGMSGTL(("serverRequestsPerSec", "Initializing the serverRequestsPerSec module\n"));
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     *
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function.
+     */
+    DEBUGMSGTL(("serverRequestsPerSec",
+                "Initializing serverRequestsPerSec scalar integer.  Default value = %s\n",
+                serverRequestsPerSec_str));
+
+     netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverRequestsPerSec",
+            handler_serverRequestsPerSec,
+            serverRequestsPerSec_oid,
+            OID_LENGTH(serverRequestsPerSec_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverRequestsPerSec_str, sizeof(serverRequestsPerSec_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+
+    DEBUGMSGTL(("serverRequestsPerSec", "Done initalizing serverRequestsPerSec module\n"));
+}
+
+
+int
+handler_serverRequestsPerSec(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    // temp variable for reading tmp file.
+    float serverRequestsPerSec_tmp = 0;
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+	// 22/07/04 - EP - don´t need call check_estado here
+	//	if (check_estado())		// si Apache está ejecutándose..
+	//	{
+	//		int x;
+	//		DEBUGMSGTL(("serverRequestsPerSec", "send_http_get -->\n"));
+	if (send_http_get("/ap2_snmp"))
+	{
+		FILE *fp;	// interchange filehandler
+    		//DEBUGMSGTL(("serverRequestsPerSec","send_http_get.  valor= %d\n",x));
+
+    		 if ((fp = fopen(serverTmpDir_str,"r")) == NULL)
+			{
+				DEBUGMSGTL(("serverRequestsPerSec", "cannot open temporal file."));
+			}
+		 else
+		 	{
+				DEBUGMSGTL(("serverRequestsPerSec", "Reading data from temporal file."));
+				rewind(fp);
+			 	fseek(fp,2*sizeof(unsigned long)+sizeof(int)*2,SEEK_SET);
+			 	fread(&serverRequestsPerSec_tmp,sizeof(float),1,fp);
+				fclose(fp);
+
+				sprintf(serverRequestsPerSec_str,"%f",serverRequestsPerSec_tmp);
+
+				snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
+										(u_char *)
+										serverRequestsPerSec_str
+										,
+										strlen(serverRequestsPerSec_str)-1
+										);
+		 	}
+	}
+        break;
+    case MODE_SET_RESERVE1:
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        break;
+    case MODE_SET_UNDO:
+        break;
+    default:
+        /*
+         * we should never get here, so this is a really bad error
+         */
+        return SNMP_ERR_GENERR;
+    }
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverRequestsPerSec.h net-snmp-5.4/agent/mibgroup/apache2/serverRequestsPerSec.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverRequestsPerSec.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverRequestsPerSec.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERREQUESTSPERSEC_H
+#define SERVERREQUESTSPERSEC_H
+
+/*
+ * function declarations
+ */
+void            	init_serverRequestsPerSec(void);
+Netsnmp_Node_Handler 	handler_serverRequestsPerSec;
+
+#endif                          /* serverRequestsPerSec_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverRestart.c net-snmp-5.4/agent/mibgroup/apache2/serverRestart.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverRestart.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverRestart.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,132 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverRestart.h"
+#include "module_init.h"
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+extern int 		agentHttpAccess;	 	// total accesos HTTP del agente
+extern int 		serverStatus;	// por defecto va apagado 
+extern int 		last_status;
+char serverRestart_str[MY_MAX_LEN];
+time_t tiempo_inicial;
+
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_serverRestart(void)
+{
+   static oid      serverRestart_oid[] = { MOD_SNMP_OID 1 , 4};
+   
+   DEBUGMSGTL(("serverRestart","Initializing the serverRestart module\n"));
+
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverRestart", 
+            handle_serverRestart,
+            serverRestart_oid,
+            OID_LENGTH(serverRestart_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverRestart_str, sizeof(serverRestart_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+        
+    DEBUGMSGTL(("serverRestart",
+                "Done initalizing serverRestart module\n"));
+}
+
+
+int
+handle_serverRestart(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+    
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+        break;
+    case MODE_SET_RESERVE1:
+        tiempo_inicial = time(NULL);
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        // Ok --> send restart notification
+        agentHttpAccess = 0; 					// Initialize agent HTTP access
+        send_restart_notification();				// send notification
+        break;
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+    return SNMP_ERR_NOERROR;
+}
+
+void send_restart_notification()
+{
+    /* For Trap sending */
+    oid             objid_snmptrap[] = { NOTIFICATION_OID };
+    size_t          objid_snmptrap_len = OID_LENGTH(objid_snmptrap);
+
+    /* NOTIFICATION-TYPE */
+    oid             serverRestartNotification_oid[] = { MOD_SNMP_OID 4, 2 };
+    size_t          serverRestartNotification_oid_len = OID_LENGTH(serverRestartNotification_oid);
+    
+    netsnmp_variable_list *serverRestartNotification_vars = NULL;
+    
+    DEBUGMSGTL(("serverRestart", "NOTIFICATION - Inicio\n"));
+  	    
+	    DEBUGMSGTL(("serverRestart", "NOTIFICATION - definicion de OID's a enviar 1\n"));
+    
+	    snmp_varlist_add_variable(&serverRestartNotification_vars,
+	                              objid_snmptrap, objid_snmptrap_len,
+	                              ASN_OBJECT_ID,
+	                              (u_char *) serverRestartNotification_oid,
+	                              serverRestartNotification_oid_len * sizeof(oid));
+	    
+	    DEBUGMSGTL(("serverRestart", "NOTIFICATION - definicion de OID's a enviar 2\n"));
+	    
+	    snmp_varlist_add_variable(&serverRestartNotification_vars,
+	                              serverRestartNotification_oid, serverRestartNotification_oid_len,
+	                              ASN_OCTET_STR,
+	                              (u_char *) serverRestart_str,
+	                              strlen(serverRestart_str));
+
+          DEBUGMSGTL(("serverRestart", "NOTIFICATION - sending the trap\n"));
+    	    send_v2trap(serverRestartNotification_vars);
+	    DEBUGMSGTL(("serverRestart", "NOTIFICATION - cleaning up\n"));
+    	    snmp_free_varbind(serverRestartNotification_vars);
+}
\ No newline at end of file
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverRestart.h net-snmp-5.4/agent/mibgroup/apache2/serverRestart.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverRestart.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverRestart.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERRESTART_H
+#define SERVERRESTART_H
+
+/*
+ * function declarations 
+ */
+void            init_serverRestart(void);
+Netsnmp_Node_Handler handle_serverRestart;
+void		send_restart_notification();
+#endif                          /* SERVERRESTART_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverRoot.c net-snmp-5.4/agent/mibgroup/apache2/serverRoot.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverRoot.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverRoot.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,74 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverRoot.h"
+#include "module_init.h"
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+/*static char serverRoot_str[MY_MAX_LEN];*/
+/*extern char serverRoot_str[254];*/
+char serverRoot_str[MY_MAX_LEN];  
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_serverRoot(void)
+{
+   static oid      serverRoot_oid[] =
+        { MOD_SNMP_OID 1 , 5};
+    /*
+     * a debugging statement.  Run the agent with -DserverRoot to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("serverRoot", "Initializing the serverRoot module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+   netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverRoot", 
+            NULL,
+            serverRoot_oid,
+            OID_LENGTH(serverRoot_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverRoot_str, sizeof(serverRoot_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+        
+    DEBUGMSGTL(("serverRoot", "Done initalizing serverRoot module\n"));
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverRoot.h net-snmp-5.4/agent/mibgroup/apache2/serverRoot.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverRoot.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverRoot.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,13 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERROOT_H
+#define SERVERROOT_H
+
+/*
+ * function declarations 
+ */
+void            init_serverRoot(void);
+
+#endif                          /* SERVERROOT_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverStatus.c net-snmp-5.4/agent/mibgroup/apache2/serverStatus.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverStatus.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverStatus.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,256 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverStatus.h"
+#include "module_init.h"
+
+extern char serverRestart_str[MY_MAX_LEN];
+extern char serverName_str[MY_MAX_LEN];
+/*extern char serverRoot_str[MY_MAX_LEN];*/
+extern char serverPidfile_str[MY_MAX_LEN];
+
+int serverStatus = 0;	// set default value (down)
+int last_status = 0;	// last status value
+
+void
+init_serverStatus(void)
+{
+    static oid      serverStatus_oid[] =
+        { MOD_SNMP_OID 2, 5 };
+
+    DEBUGMSGTL(("serverStatus", "Register scalar\n"));
+    netsnmp_register_scalar(netsnmp_create_handler_registration
+                            ("serverStatus", handle_serverStatus,
+                             serverStatus_oid,
+                             OID_LENGTH(serverStatus_oid),
+                             HANDLER_CAN_RWRITE));
+
+    DEBUGMSGTL(("serverStatus", "Register notification alarm\n"));
+    snmp_alarm_register(30,     /* seconds */
+                        SA_REPEAT,      /* repeat (every 30 seconds). */
+                        send_status_notification,      /* our callback */
+                        NULL    /* no callback data needed */
+		        );
+
+}
+
+int
+handle_serverStatus(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    /*
+     * a instance handler also only hands us one request at a time, so
+     * we don't need to loop over a list of requests; we'll only get one.
+     */
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+	serverStatus = check_estado();
+	snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER,
+                                 (u_char *)
+                                 &serverStatus
+                                 ,
+                                 sizeof(serverStatus)
+                                 );
+        break;
+    case MODE_SET_RESERVE1:
+	serverStatus = *requests->requestvb->val.integer;
+	send_notification(serverStatus);
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        break;
+
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+
+    return SNMP_ERR_NOERROR;
+}
+
+void send_status_notification(unsigned int clientreg, void *clientarg)
+{
+    /* Para el envio de traps */
+    oid             objid_snmptrap[] = { NOTIFICATION_OID };
+    size_t          objid_snmptrap_len = OID_LENGTH(objid_snmptrap);
+
+    /* NOTIFICATION-TYPE */
+    oid             serverRestartNotification_oid[] = { MOD_SNMP_OID 4, 1 };
+    size_t          serverRestartNotification_oid_len = OID_LENGTH(serverRestartNotification_oid);
+
+    netsnmp_variable_list *serverRestartNotification_vars = NULL;
+
+    DEBUGMSGTL(("serverStatus", "NOTIFICATION - Init\n"));
+    serverStatus = check_estado();
+    DEBUGMSGTL(("serverStatus", "NOTIFICATION -%d %d\n",serverStatus,last_status));
+    if (last_status != serverStatus)
+    {
+	    last_status = serverStatus;
+
+	    DEBUGMSGTL(("serverStatus", "NOTIFICATION - OID for sending 1\n"));
+
+	    snmp_varlist_add_variable(&serverRestartNotification_vars,
+	                              objid_snmptrap, objid_snmptrap_len,
+	                              ASN_OBJECT_ID,
+	                              (u_char *) serverRestartNotification_oid,
+	                              serverRestartNotification_oid_len * sizeof(oid));
+
+	    DEBUGMSGTL(("serverStatus", "NOTIFICATION - OID for sending  2\n"));
+	    snmp_varlist_add_variable(&serverRestartNotification_vars,
+	                              serverRestartNotification_oid, serverRestartNotification_oid_len,
+	                              ASN_OCTET_STR,
+	                              (u_char *) serverName_str,
+	                              strlen(serverName_str));
+
+	    DEBUGMSGTL(("serverStatus", "NOTIFICATION - OID for sending  3\n"));
+	    snmp_varlist_add_variable(&serverRestartNotification_vars,
+	                              serverRestartNotification_oid, serverRestartNotification_oid_len,
+	                              ASN_INTEGER,
+	                              (u_char *) &serverStatus,
+	                              sizeof(serverStatus));
+
+            DEBUGMSGTL(("serverStatus", "NOTIFICATION - sending trap\n"));
+    	    send_v2trap(serverRestartNotification_vars);
+	    DEBUGMSGTL(("serverStatus", "NOTIFICATION - cleaning up\n"));
+    	    snmp_free_varbind(serverRestartNotification_vars);
+	}
+}
+
+void send_notification(int status)
+{
+    /* For trap sending */
+    oid             objid_snmptrap[] = { NOTIFICATION_OID };
+    size_t          objid_snmptrap_len = OID_LENGTH(objid_snmptrap);
+
+    /* NOTIFICATION-TYPE */
+    oid             serverRestartNotification_oid[] = { MOD_SNMP_OID 4, status };
+    size_t          serverRestartNotification_oid_len = OID_LENGTH(serverRestartNotification_oid);
+
+    netsnmp_variable_list *serverRestartNotification_vars = NULL;
+
+    DEBUGMSGTL(("serverStatus", "NOTIFICATION - OID for sending  1\n"));
+
+    serverStatus = status;
+
+    snmp_varlist_add_variable(&serverRestartNotification_vars,
+                              objid_snmptrap, objid_snmptrap_len,
+                              ASN_OBJECT_ID,
+                              (u_char *) serverRestartNotification_oid,
+                              serverRestartNotification_oid_len * sizeof(oid));
+
+    	    DEBUGMSGTL(("serverStatus", "NOTIFICATION - OID for sending  2\n"));
+	    snmp_varlist_add_variable(&serverRestartNotification_vars,
+	                              serverRestartNotification_oid, serverRestartNotification_oid_len,
+	                              ASN_OCTET_STR,
+	                              (u_char *) serverName_str,
+	                              strlen(serverName_str));
+
+    DEBUGMSGTL(("serverStatus", "NOTIFICATION - OID for sending  3\n"));
+    snmp_varlist_add_variable(&serverRestartNotification_vars,
+                              serverRestartNotification_oid, serverRestartNotification_oid_len,
+                              ASN_INTEGER,
+                              (u_char *) &serverStatus,
+                              sizeof(serverStatus));
+
+    DEBUGMSGTL(("serverStatus", "NOTIFICATION - sending the trap\n"));
+    send_v2trap(serverRestartNotification_vars);
+    DEBUGMSGTL(("serverStatus", "NOTIFICATION - cleaning up\n"));
+    snmp_free_varbind(serverRestartNotification_vars);
+}
+
+/* check apache status */
+int check_estado()
+{
+	int	estado;
+	FILE	*fp = NULL;
+
+	DEBUGMSGTL(("serverStatus", "FCN - check_estado - Init\n"));
+
+/*	if ((fp = fopen(serverPidfile_str,"r"))==NULL)
+    		{
+			DEBUGMSGTL(("serverStatus", "FCN - check_estado - Can't open Pidfile\n"));
+		    DEBUGMSGTL(("serverStatus", "Pidfile -%s\n",serverPidfile_str));
+			estado = SERVER_DOWN;	//Apagado
+		}
+	else
+		{
+			if (send_http_get("/ap2_snmp/status"))
+			{
+    				estado = SERVER_UP;		// it´s running and response ok
+    				DEBUGMSGTL(("serverStatus", "FCN - check_estado - Ok\n"));
+
+			}
+			else
+			{
+				estado = SERVER_NOT_RESPONDING;	// Not responding
+    				DEBUGMSGTL(("serverStatus", "FCN - check_estado - Not responding\n"));
+
+			}
+
+			fclose(fp);
+		}
+
+*/
+			// First check if apache is responding
+			if (send_http_get("/ap2_snmp/status") == 1)
+			{
+    				estado = SERVER_UP;		// it´s running and response ok
+    				DEBUGMSGTL(("serverStatus", "FCN - check_estado - Ok\n"));
+
+			}
+			// if not, check that pidfile doesn't exist
+			else if ((fp = fopen(serverPidfile_str,"r"))==NULL)
+    		{
+					DEBUGMSGTL(("serverStatus", "FCN - check_estado - Can't open Pidfile\n"));
+			  	    DEBUGMSGTL(("serverStatus", "Pidfile -%s\n",serverPidfile_str));
+					estado = SERVER_DOWN;	//Apagado
+			}
+			// if apache doesn't work and pidfile exist, apache is not responding
+			else
+			{
+					estado = SERVER_NOT_RESPONDING;	// Not responding
+    				DEBUGMSGTL(("serverStatus", "FCN - check_estado - Not responding\n"));
+
+			}
+
+			// if file is open -> we close
+			if (fp != NULL) {
+					DEBUGMSGTL(("serverStatus", "FCN - check_estado - Close file (PidFile)\n"));
+					fclose(fp);
+			}
+
+
+	DEBUGMSGTL(("serverStatus", "FCN - check_estado - End (%d)\n",estado));
+	return(estado);
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverStatus.h net-snmp-5.4/agent/mibgroup/apache2/serverStatus.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverStatus.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverStatus.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,17 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef SERVERSTATUS_H
+#define SERVERSTATUS_H
+
+/*
+ * function declarations 
+ */
+void            	init_serverStatus(void);
+Netsnmp_Node_Handler 	handle_serverStatus;
+int 			check_estado();
+SNMPAlarmCallback send_status_notification;
+void 			send_notification(int);	
+
+#endif                          /* SERVERSTATUS_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverTmpDir.c net-snmp-5.4/agent/mibgroup/apache2/serverTmpDir.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverTmpDir.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverTmpDir.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,72 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverTmpDir.h"
+#include "module_init.h"
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+char serverTmpDir_str[MY_MAX_LEN];  
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_serverTmpDir(void)
+{
+   static oid      serverTmpDir_oid[] =
+        { MOD_SNMP_OID 1 , 7};
+    /*
+     * a debugging statement.  Run the agent with -DserverTmpDir to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("serverTmpDir", "Initializing the serverTmpDir module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+   netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverTmpDir", 
+            NULL,
+            serverTmpDir_oid,
+            OID_LENGTH(serverTmpDir_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverTmpDir_str, sizeof(serverTmpDir_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+        
+    DEBUGMSGTL(("serverTmpDir", "Done initalizing serverTmpDir module\n"));
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverTmpDir.h net-snmp-5.4/agent/mibgroup/apache2/serverTmpDir.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverTmpDir.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverTmpDir.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,13 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERTMPDIR_H
+#define SERVERTMPDIR_H
+
+/*
+ * function declarations 
+ */
+void            init_serverTmpDir(void);
+
+#endif                          /* SERVERROOT_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverUptime.c net-snmp-5.4/agent/mibgroup/apache2/serverUptime.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverUptime.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverUptime.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,171 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverUptime.h"
+#include "module_init.h"
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+/* global variable for calculate time since last restart */
+extern time_t tiempo_inicial;
+extern char serverPidfile_str[MY_MAX_LEN];
+
+static char serverUptime_str[MY_MAX_LEN];
+
+
+// aux function which returns time in string format
+void format_tiempo(time_t tsecs, char* buf_final)
+{
+    int days, hrs, mins, secs;
+    char buf_temp[MY_MAX_LEN];
+
+    secs = (int)(tsecs % 60);
+    tsecs /= 60;
+    mins = (int)(tsecs % 60);
+    tsecs /= 60;
+    hrs = (int)(tsecs % 24);
+    days = (int)(tsecs / 24);
+
+    strcpy(buf_final,"");
+    if (days)
+        {
+        	sprintf(buf_temp, " %d day%s", days, days == 1 ? "" : "s");
+        	strcat(buf_final,buf_temp);
+        }
+    if (hrs)
+        {
+ 	       sprintf(buf_temp, " %d hour%s", hrs, hrs == 1 ? "" : "s");
+ 	       strcat(buf_final,buf_temp);
+	}
+    if (mins)
+        {
+               sprintf(buf_temp, " %d min%s", mins, mins == 1 ? "" : "s");
+               strcat(buf_final,buf_temp);
+	}
+    if (secs)
+        {
+               sprintf(buf_temp, " %d sec%s", secs, secs == 1 ? "" : "s");
+               strcat(buf_final,buf_temp);
+	}
+
+}
+
+
+/*
+ * our initialization routine, automatically called by the agent
+ * (to get called, the function name must match init_FILENAME())
+ */
+void
+init_serverUptime(void)
+{
+    static oid      serverUptime_oid[] =
+        { MOD_SNMP_OID 2, 6 };
+
+    /*
+     * a debugging statement.  Run the agent with -DserverUptime to see
+     * the output of this debugging statement.
+     */
+    DEBUGMSGTL(("serverUptime", "Initializing the serverUptime module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     *
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function.
+     */
+
+     netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverUptime",
+            handler_serverUptime,
+            serverUptime_oid,
+            OID_LENGTH(serverUptime_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverUptime_str, sizeof(serverUptime_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+
+    DEBUGMSGTL(("serverUptime", "Done initalizing serverUptime module\n"));
+}
+
+int
+handler_serverUptime(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+time_t tiempo_actual, tiempo_uptime;
+
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+	if (check_estado())		// si Apache está ejecutándose..
+	{
+		tiempo_actual = time(NULL);
+		tiempo_uptime = tiempo_actual - tiempo_inicial;
+		format_tiempo(tiempo_uptime,serverUptime_str);
+	}
+	else
+		strcpy(serverUptime_str,"Not running\r\n");
+
+	snmp_set_var_typed_value(requests->requestvb, ASN_OCTET_STR,
+	                        (u_char *)
+	                        serverUptime_str
+	                        ,
+	                        strlen(serverUptime_str)-1
+	                        );
+
+        break;
+    case MODE_SET_RESERVE1:
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        break;
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        /*
+         * we should never get here, so this is a really bad error
+         */
+        return SNMP_ERR_GENERR;
+    }
+    return SNMP_ERR_NOERROR;
+}
+
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverUptime.h net-snmp-5.4/agent/mibgroup/apache2/serverUptime.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverUptime.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverUptime.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERUPTIME_H
+#define SERVERUPTIME_H
+
+/*
+ * function declarations
+ */
+void            init_serverUptime(void);
+Netsnmp_Node_Handler handler_serverUptime;
+void format_tiempo(time_t, char*);
+#endif                          /* SERVERUPTIME_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverVersion.c net-snmp-5.4/agent/mibgroup/apache2/serverVersion.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverVersion.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverVersion.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,76 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "serverVersion.h"
+#include "module_init.h"
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+static char serverVersion_str[MY_MAX_LEN];
+
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_serverVersion(void)
+{
+
+   static oid      serverVersion_oid[] =
+       { MOD_SNMP_OID 1, 2};
+    /*
+     * a debugging statement.  Run the agent with -DserverVersion to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("serverVersion",
+                "Initializing the serverVersion module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "serverVersion", 
+            NULL,
+            serverVersion_oid,
+            OID_LENGTH(serverVersion_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &serverVersion_str, sizeof(serverVersion_str),
+            ASN_OCTET_STR, WATCHER_MAX_SIZE)
+        );
+
+    DEBUGMSGTL(("serverVersion",
+                "Done initalizing serverVersion module\n"));
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/serverVersion.h net-snmp-5.4/agent/mibgroup/apache2/serverVersion.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/serverVersion.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/serverVersion.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,13 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef SERVERVERSION_H
+#define SERVERVERSION_H
+
+/*
+ * function declarations 
+ */
+void            init_serverVersion(void);
+
+#endif                          /* SERVERVERSION_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/totalAccess.c net-snmp-5.4/agent/mibgroup/apache2/totalAccess.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/totalAccess.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/totalAccess.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,243 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "totalAccess.h"
+#include "module_init.h"
+
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+static unsigned long    totalAccess = 0;       		// accesos totales del Apache
+extern char		serverTmpDir_str[MY_MAX_LEN];	// ubicacion archivo de intercambio
+extern int 		agentHttpAccess;	 	// total accesos HTTP del agente
+extern char 		agentHttpAddress_str[MY_MAX_LEN];
+
+/*
+ * our initialization routine, automatically called by the agent
+ * (to get called, the function name must match init_FILENAME())
+ */
+void
+init_totalAccess(void)
+{
+    static oid      totalAccess_oid[] =
+        { MOD_SNMP_OID 2, 2 };
+
+    /*
+     * a debugging statement.  Run the agent with -DtotalAccess to see
+     * the output of this debugging statement.
+     */
+    DEBUGMSGTL(("totalAccess", "Initializing the totalAccess module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     *
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function.
+     */
+    DEBUGMSGTL(("totalAccess",
+                "Initializing totalAccess scalar integer.  Default value = %d\n",
+                totalAccess));
+
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "totalAccess",
+            handler_totalAccess,
+            totalAccess_oid,
+            OID_LENGTH(totalAccess_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &totalAccess, sizeof(totalAccess),
+            ASN_COUNTER, WATCHER_MAX_SIZE)
+        );
+    DEBUGMSGTL(("totalAccess", "Done initalizing totalAccess module\n"));
+}
+
+int
+handler_totalAccess(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+	// 22/07/04 - EP - don´t need call check_estado here
+	//	if (check_estado())		// check Apache status
+	//	{
+			//int x;		// not used
+	//DEBUGMSGTL(("totalAccess", "send_http_get -->\n"));
+	if (send_http_get("/ap2_snmp"))
+	{
+		FILE *fp;		// exchange file
+    		//DEBUGMSGTL(("totalAccess","send_http_get.  valor= %d\n",x));
+    		 if ((fp = fopen(serverTmpDir_str,"r")) == NULL)
+			{
+				DEBUGMSGTL(("totalAccess", "cannot open temporal file."));
+			}
+		 else
+		 	{
+				DEBUGMSGTL(("totalAccess", "Reading data from temporal file."));
+				rewind(fp);
+			 	fread(&totalAccess,sizeof(unsigned long),1,fp);
+				fclose(fp);
+				DEBUGMSGTL(("totalAccess","totalAccess = %i - agentHttpAccess= %i\n",totalAccess,agentHttpAccess));
+				/*
+					21/07/04 - EP - totalAccess returns only client's http requests (not count snmp agent HTTP requests)
+				*/
+				totalAccess = totalAccess - agentHttpAccess;
+		    		snmp_set_var_typed_value(requests->requestvb, ASN_COUNTER,
+			                        	(u_char *)
+			                        	&totalAccess
+			                        	,
+			                        	sizeof(totalAccess)
+			                        	);
+		 	}
+	}
+        break;
+    case MODE_SET_RESERVE1:
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        break;
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        /*
+         * we should never get here, so this is a really bad error
+         */
+        return SNMP_ERR_GENERR;
+    }
+    return SNMP_ERR_NOERROR;
+}
+
+int send_http_get (char* uri)
+{
+	int sockfd;
+	char caracter;
+	char linea_send [MAX_SEND];
+	char linea_recv [MAX_RECEIVE];
+	int rcv_bytes;
+	char* http_port;
+	char agentHttpAddress_str_temp[MY_MAX_LEN];
+
+// conexion
+	struct sockaddr_in serv_addr;
+
+	bzero( (char *) &serv_addr, sizeof(serv_addr));
+	serv_addr.sin_family = AF_INET;
+
+	if (strlen(agentHttpAddress_str) == 0)
+	{
+		serv_addr.sin_addr.s_addr = inet_addr(DEFAULT_ADDRESS);	// IP Address
+		serv_addr.sin_port = htons(DEFAULT_PORT);		// Port
+	}
+	else
+	{
+		strcpy(agentHttpAddress_str_temp,agentHttpAddress_str); // Temporal string
+		http_port = strtok(agentHttpAddress_str_temp,":");
+		http_port = strtok('\0',":");
+		serv_addr.sin_addr.s_addr = inet_addr(agentHttpAddress_str_temp);	// Ip Address
+		serv_addr.sin_port = htons(atol(http_port));		// Port
+		DEBUGMSGTL(("totalAccess","send_http_get.  address= %s - port= %s\n",agentHttpAddress_str_temp,http_port));
+	}
+
+
+	/* Opens TCP socket */
+	if ( ( sockfd = socket( AF_INET, SOCK_STREAM, 0) ) < 0 )
+	{
+		close(sockfd);	// close connection
+		perror( "client: socket() Error\n");
+		DEBUGMSGTL(("totalAccess", "send_http_get --> Socket Error\n"));
+		return -1;
+	}
+
+	/* Connects */
+	if ( connect (sockfd, (struct sockaddr *) &serv_addr, sizeof(serv_addr)) < 0 )
+	{
+		perror("client: connect() Error \n");
+		DEBUGMSGTL(("totalAccess", "send_http_get --> Connect Error\n"));
+		return -1;
+	}
+
+	//	printf("Conectado...\n");
+
+	strcpy(linea_recv,"");
+	sprintf(linea_send,"GET %s \r\n",uri);
+	DEBUGMSGTL(("totalAccess", "send_http_get --> send GET %s \n",uri));
+	//strcpy(linea_send,"GET /ap2_snmp \r\n");
+
+		if ( strlen(linea_send) > 0)
+		{
+			//printf("Send.. %s",linea_send);
+			send( sockfd, linea_send, MAX_SEND, 0);
+			strcpy(linea_recv,"");
+			rcv_bytes = recv( sockfd, linea_recv, MAX_RECEIVE , 0);
+
+			if (rcv_bytes > 0)
+				{
+					linea_recv[rcv_bytes] = '\0';
+				DEBUGMSGTL(("totalAccess", "send_http_get --> response %s \n",linea_recv));
+				if (strcmp(linea_recv,"OK")==0)
+		 			{
+		 				printf("OK");
+		 				DEBUGMSGTL(("totalAccess", "send_http_get --> return Ok\n"));
+		 				close(sockfd);
+		 				agentHttpAccess++;  // + HTTP request generated by SNMP agent (to check status)
+		 				return 1;	// 	OK
+		 			}
+		 			else
+		 			{
+		 				printf("AP2-SNMP: HTTP Response Error.");
+		 				DEBUGMSGTL(("totalAccess", "send_http_get --> return HTTP Error\n"));
+		 				close(sockfd);
+		 				return 0;	//	error
+		 			}
+				}
+			else
+			{
+				printf("AP2-SNMP: cannot connect (HTTP)");
+				close(sockfd);
+				return 0;	//	error
+			}
+		}
+		else
+		{
+			close(sockfd);
+			return 0;	//	error
+		}
+}
\ No newline at end of file
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/totalAccess.h net-snmp-5.4/agent/mibgroup/apache2/totalAccess.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/totalAccess.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/totalAccess.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,15 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef TOTALACCESS_H
+#define TOTALACCESS_H
+
+/*
+ * function declarations 
+ */
+void            	init_totalAccess(void);
+Netsnmp_Node_Handler 	handler_totalAccess;
+int 			send_http_get(char*);
+
+#endif                          /* TOTALACCESS_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/totalServerPorts.c net-snmp-5.4/agent/mibgroup/apache2/totalServerPorts.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/totalServerPorts.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/totalServerPorts.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,86 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "totalServerPorts.h"
+#include "module_init.h"
+
+/** Initializes the totalServerPorts module */
+int totalServerPorts = 0;
+
+void
+init_totalServerPorts(void)
+{
+    static oid      totalServerPorts_oid[] =
+        { MOD_SNMP_OID 1, 9 };
+
+    DEBUGMSGTL(("totalServerPorts", "Initializing\n"));
+
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "totalServerPorts", 
+            handle_totalServerPorts,
+            totalServerPorts_oid,
+            OID_LENGTH(totalServerPorts_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &totalServerPorts, sizeof(totalServerPorts),
+            ASN_INTEGER, WATCHER_MAX_SIZE)
+        );                             
+}
+
+int
+handle_totalServerPorts(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+        break;
+
+    case MODE_SET_RESERVE1:
+        break;
+
+    case MODE_SET_RESERVE2:
+        break;
+
+    case MODE_SET_FREE:
+        break;
+
+    case MODE_SET_ACTION:
+        break;
+
+    case MODE_SET_COMMIT:
+	clean_table(); // Clean table
+        break;
+
+    case MODE_SET_UNDO:
+        break;
+
+    default:
+        return SNMP_ERR_GENERR;
+    }
+
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/totalServerPorts.h net-snmp-5.4/agent/mibgroup/apache2/totalServerPorts.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/totalServerPorts.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/totalServerPorts.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.scalar.conf,v 1.7 2003/04/08 14:57:04 dts12 Exp $
+ */
+#ifndef TOTALSERVERPORTS_H
+#define TOTALSERVERPORTS_H
+
+/*
+ * function declarations 
+ */
+void            	init_totalServerPorts(void);
+Netsnmp_Node_Handler 	handle_totalServerPorts;
+
+#endif                          /* TOTALSERVERPORTS_H */
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/totalTraffic.c net-snmp-5.4/agent/mibgroup/apache2/totalTraffic.c
--- net-snmp-5.4_orig/agent/mibgroup/apache2/totalTraffic.c	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/totalTraffic.c	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,144 @@
+/*
+	Copyright 2004 Esteban Pizzini
+
+	This program is free software; you can redistribute it and/or modify
+	it under the terms of the GNU General Public License as published by
+	the Free Software Foundation; either version 2 of the License, or
+	(at your option) any later version.
+
+	This program is distributed in the hope that it will be useful,
+	but WITHOUT ANY WARRANTY; without even the implied warranty of
+	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+	GNU General Public License for more details.
+
+	You should have received a copy of the GNU General Public License
+	along with this program; if not, write to the Free Software
+	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+*/
+
+#include <net-snmp/net-snmp-config.h>
+#include <net-snmp/net-snmp-includes.h>
+#include <net-snmp/agent/net-snmp-agent-includes.h>
+#include <net-snmp/agent/watcher.h>
+#include "totalTraffic.h"
+#include "module_init.h"
+
+
+/*
+ * the variable we want to tie an OID to.  The agent will handle all
+ * * GET and SET requests to this variable changing its value as needed.
+ */
+
+static unsigned long      totalTraffic = 0;       	/* Init TotalTraffic */
+extern char serverTmpDir_str[MY_MAX_LEN];	 	/* interchange file*/
+
+/*
+ * our initialization routine, automatically called by the agent 
+ * (to get called, the function name must match init_FILENAME()) 
+ */
+void
+init_totalTraffic(void)
+{
+    static oid      totalTraffic_oid[] =
+        { MOD_SNMP_OID 2, 1 };
+
+    /*
+     * a debugging statement.  Run the agent with -DtotalTraffic to see
+     * the output of this debugging statement. 
+     */
+    DEBUGMSGTL(("totalTraffic", "Initializing the totalTraffic module\n"));
+
+
+    /*
+     * the line below registers our variables defined above as
+     * accessible and makes them writable.  A read only version of any
+     * of these registrations would merely call
+     * register_read_only_int_instance() instead.  The functions
+     * called below should be consistent with your MIB, however.
+     * 
+     * If you wanted a callback when the value was retrieved or set
+     * (even though the details of doing this are handled for you),
+     * you could change the NULL pointer below to a valid handler
+     * function. 
+     */
+    DEBUGMSGTL(("totalTraffic",
+                "Initializing totalTraffic scalar integer.  Default value = %d\n",
+                totalTraffic));
+
+    netsnmp_register_watched_scalar(
+        netsnmp_create_handler_registration(
+            "totalTraffic", 
+            handler_totalTraffic,
+            totalTraffic_oid,
+            OID_LENGTH(totalTraffic_oid),
+            HANDLER_CAN_RWRITE),
+        netsnmp_create_watcher_info(
+            &totalTraffic, sizeof(totalTraffic),
+            ASN_INTEGER, WATCHER_MAX_SIZE)
+        );
+
+    DEBUGMSGTL(("totalTraffic", "Done initalizing totalTraffic module\n"));
+}
+
+
+int
+handler_totalTraffic(netsnmp_mib_handler *handler,
+                    netsnmp_handler_registration *reginfo,
+                    netsnmp_agent_request_info *reqinfo,
+                    netsnmp_request_info *requests)
+{
+
+    switch (reqinfo->mode) {
+
+    case MODE_GET:
+	// 22/07/04 - EP - don´t need call check_estado here
+	//	if (check_estado())		// si Apache está ejecutándose..
+	//	{
+	//		int x;
+	//		DEBUGMSGTL(("totalTraffic", "send_http_get -->\n"));
+	if (send_http_get("/ap2_snmp")) 
+	{
+		FILE *fp;	// interchange filehandler
+    		//DEBUGMSGTL(("totalTraffic","send_http_get.  valor= %d\n",x));
+    		
+    		 if ((fp = fopen(serverTmpDir_str,"r")) == NULL)
+			{
+				DEBUGMSGTL(("totalTraffic", "cannot open temporal file."));
+			}
+		 else
+		 	{
+				DEBUGMSGTL(("totalTraffic", "Reading data from temporal file."));
+				rewind(fp);
+			 	fseek(fp,sizeof(unsigned long),SEEK_SET);
+			 	fread(&totalTraffic,sizeof(unsigned long),1,fp);
+				fclose(fp);
+							
+		    		snmp_set_var_typed_value(requests->requestvb, ASN_INTEGER,
+			                        	(u_char *)
+			                        	&totalTraffic
+			                        	,
+			                        	sizeof(totalTraffic)
+			                        	);
+		 	}
+	}
+        break;
+    case MODE_SET_RESERVE1:
+	break;
+    case MODE_SET_RESERVE2:
+	break;
+    case MODE_SET_FREE:
+	break;
+    case MODE_SET_ACTION:
+	break;
+    case MODE_SET_COMMIT:
+        break;
+    case MODE_SET_UNDO:
+        break;
+    default:
+        /*
+         * we should never get here, so this is a really bad error 
+         */
+        return SNMP_ERR_GENERR;
+    }
+    return SNMP_ERR_NOERROR;
+}
diff -ru -ruN net-snmp-5.4_orig/agent/mibgroup/apache2/totalTraffic.h net-snmp-5.4/agent/mibgroup/apache2/totalTraffic.h
--- net-snmp-5.4_orig/agent/mibgroup/apache2/totalTraffic.h	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/agent/mibgroup/apache2/totalTraffic.h	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,14 @@
+/*
+ * Note: this file originally auto-generated by mib2c using
+ *        : mib2c.int_watch.conf,v 1.2 2002/07/17 14:41:53 dts12 Exp $
+ */
+#ifndef TOTALTRAFFIC_H
+#define TOTALTRAFFIC_H
+
+/*
+ * function declarations 
+ */
+void            	init_totalTraffic(void);
+Netsnmp_Node_Handler 	handler_totalTraffic;
+
+#endif                          /* totalTraffic_H */
diff -ru -ruN net-snmp-5.4_orig/mibs/APACHE2-MIB.txt net-snmp-5.4/mibs/APACHE2-MIB.txt
--- net-snmp-5.4_orig/mibs/APACHE2-MIB.txt	1970-01-01 01:00:00.000000000 +0100
+++ net-snmp-5.4/mibs/APACHE2-MIB.txt	2007-01-19 11:11:31.000000000 +0100
@@ -0,0 +1,321 @@
+APACHE2-MIB DEFINITIONS ::= BEGIN
+
+IMPORTS
+	enterprises			      FROM SNMPv2-SMI
+	DisplayString  			      FROM SNMPv2-TC
+	OBJECT-TYPE, Integer32,Counter32,Gauge32
+	MODULE-IDENTITY                       FROM SNMPv2-SMI
+	MODULE-COMPLIANCE, OBJECT-GROUP       FROM SNMPv2-CONF;
+
+apache2-mib MODULE-IDENTITY
+    LAST-UPDATED "200402180000Z"
+    ORGANIZATION "Esteban Pizzini"
+    CONTACT-INFO    
+	 " Esteban Pizzini
+	   ep@fibertel.com.ar"
+    DESCRIPTION
+	"Apache2 Mib"
+    REVISION     "200402210000Z"
+    DESCRIPTION
+	"First draft"
+    ::= {enterprises 19786 1 1}
+
+apache2MIBInformation     OBJECT IDENTIFIER ::= { apache2-mib 1 }
+apache2MIBStatus          OBJECT IDENTIFIER ::= { apache2-mib 2 }
+apache2MIBNotifications	  OBJECT IDENTIFIER ::= { apache2-mib 4 }
+apache2MIBHttpErrors      OBJECT IDENTIFIER ::= { apache2-mib 5 }
+
+serverName OBJECT-TYPE
+       SYNTAX      DisplayString
+       MAX-ACCESS  read-only
+       STATUS      current
+       DESCRIPTION
+           "Server Name"
+       ::= { apache2MIBInformation 1 }
+
+serverVersion OBJECT-TYPE
+       SYNTAX      DisplayString
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "Apache Server Version"
+       ::= { apache2MIBInformation 2 }
+
+serverBuilt OBJECT-TYPE
+       SYNTAX      DisplayString
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "Apache build datetime"
+       ::= { apache2MIBInformation 3 }
+      
+serverRestart OBJECT-TYPE
+       SYNTAX      DisplayString
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "Last restart"
+       ::= { apache2MIBInformation 4 }
+
+serverRoot OBJECT-TYPE
+	SYNTAX		DisplayString
+	MAX-ACCESS	read-write
+	STATUS		current
+	DESCRIPTION
+		"Apache's Root Path"
+	::= { apache2MIBInformation 5}
+
+serverPidfile OBJECT-TYPE
+        SYNTAX          DisplayString
+        MAX-ACCESS      read-write
+        STATUS          current
+        DESCRIPTION
+                "Apache's PIDFILE"
+        ::= { apache2MIBInformation 6}
+
+serverTmpDir OBJECT-TYPE
+        SYNTAX          DisplayString
+        MAX-ACCESS      read-write
+        STATUS          current
+        DESCRIPTION
+                "Temporary Directory for shared files (Net-SNMP <--> Apache)"
+        ::= { apache2MIBInformation 7}
+
+agentHttpAddress OBJECT-TYPE
+        SYNTAX          DisplayString
+        MAX-ACCESS      read-write
+        STATUS          current
+        DESCRIPTION
+                "Port and Address that use the agent to get HTTP access to Apache"
+        ::= { apache2MIBInformation 8}
+
+
+totalServerPorts OBJECT-TYPE
+        SYNTAX     	Integer32
+        MAX-ACCESS      read-write
+        STATUS          current
+        DESCRIPTION
+                "Total ports listened by Apache"
+      ::= { apache2MIBInformation 9}
+      
+--
+-- Tabla de puertos escuchados (implementada en serverListenPorts.c)
+--
+
+serverListenPorts OBJECT-TYPE
+        SYNTAX     SEQUENCE OF ServerPort
+        MAX-ACCESS      not-accessible
+        STATUS          current
+        DESCRIPTION
+                "List of ports listened by Apache"
+        ::= { apache2MIBInformation 10}
+
+serverPort OBJECT-TYPE
+        SYNTAX     	ServerPort
+        MAX-ACCESS     	not-accessible
+        STATUS          current
+        DESCRIPTION
+                "List of ports listened by Apache"
+        INDEX { serverPortIndex }
+      ::= { serverListenPorts 1}
+
+ServerPort ::= SEQUENCE {
+	serverPortIndex		Integer32,
+	serverPortNumber	Integer32
+}
+
+
+serverPortIndex OBJECT-TYPE
+    SYNTAX      Integer32
+    MAX-ACCESS  not-accessible
+    STATUS      current
+    DESCRIPTION
+	"Port Index"
+    ::= { serverPort 1 }
+
+serverPortNumber OBJECT-TYPE
+    SYNTAX      Integer32
+    MAX-ACCESS  read-create
+    STATUS      current
+    DESCRIPTION
+	"Port Number"
+    ::= { serverPort 2 }
+
+-- fin tabla
+
+totalTraffic OBJECT-TYPE
+       SYNTAX      Integer32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "Total Traffic"
+       ::= { apache2MIBStatus 1 }
+
+totalAccess OBJECT-TYPE
+       SYNTAX      Counter32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "Total HTTP Accesses"
+       ::= { apache2MIBStatus 2 }
+
+busyWorkers OBJECT-TYPE
+       SYNTAX      Gauge32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "total number of Apache's busy processes"
+       ::= { apache2MIBStatus 3 }
+
+idleWorkers OBJECT-TYPE
+       SYNTAX      Gauge32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "total number of Apache's idle processes"
+       ::= { apache2MIBStatus 4 }
+
+serverStatus OBJECT-TYPE
+       SYNTAX      Integer32 { down(0), up(1), notResponding(2), starting(3), stopping(4) }
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "Status
+            0 - Down
+            1 - Up
+            2 - Starting
+            3 - Shutting down
+            4 - not responding"
+       ::= { apache2MIBStatus 5 }
+
+serverUptime OBJECT-TYPE
+       SYNTAX      DisplayString
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "Uptime"
+       ::= { apache2MIBStatus 6 }
+
+agentHttpAccess OBJECT-TYPE
+        SYNTAX          Counter32
+        MAX-ACCESS      read-write
+        STATUS          current
+        DESCRIPTION
+                "HTTP accesses generated by SNMP agent"
+        ::= { apache2MIBStatus 7}
+
+
+serverRequestsPerSec OBJECT-TYPE
+       SYNTAX      DisplayString
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+		"Requests per second" 
+	::= { apache2MIBStatus 8 }
+
+serverKBytesPerSec OBJECT-TYPE
+       SYNTAX      DisplayString
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+		"KBytes per second" 
+	::= { apache2MIBStatus 9 }
+
+serverKBytesPerRequest OBJECT-TYPE
+       SYNTAX      DisplayString
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+		"KBytes per request" 
+	::= { apache2MIBStatus 10 }
+
+
+httpError400 OBJECT-TYPE
+       SYNTAX      Counter32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "HTTP_BAD_REQUEST"
+       ::= { apache2MIBHttpErrors 400 }
+
+httpError403 OBJECT-TYPE
+       SYNTAX      Counter32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "HTTP_FORBIDDEN"
+       ::= { apache2MIBHttpErrors 403 }
+
+httpError404 OBJECT-TYPE
+       SYNTAX      Counter32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "HTTP_NOT_FOUND"
+       ::= { apache2MIBHttpErrors 404 }
+
+httpError405 OBJECT-TYPE
+       SYNTAX      Counter32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "HTTP_METHOD_NOT_ALLOWED"
+       ::= { apache2MIBHttpErrors 405 }
+
+httpError500 OBJECT-TYPE
+       SYNTAX      Counter32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "HTTP_INTERNAL_SERVER_ERROR"
+       ::= { apache2MIBHttpErrors 500 }
+
+httpError501 OBJECT-TYPE
+       SYNTAX      Counter32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "HTTP_NOT_IMPLEMENTED"
+       ::= { apache2MIBHttpErrors 501 }
+
+httpError505 OBJECT-TYPE
+       SYNTAX      Counter32
+       MAX-ACCESS  read-write
+       STATUS      current
+       DESCRIPTION
+           "HTTP_VERSION_NOT_SUPPORTED"
+       ::= { apache2MIBHttpErrors 505 }
+
+serverStatusNotification NOTIFICATION-TYPE
+    OBJECTS { serverName, serverStatus }
+    MAX-ACCESS  accessible-for-notify
+    STATUS	current
+    DESCRIPTION
+	"Server status changes"
+    ::= { apache2MIBNotifications 1 }
+
+serverRestartNotification NOTIFICATION-TYPE
+    OBJECTS { serverRestart ,serverStatus}
+    MAX-ACCESS  accessible-for-notify
+    STATUS	current
+    DESCRIPTION
+	"Server Restart"
+    ::= { apache2MIBNotifications 2 }
+
+serverStartNotification NOTIFICATION-TYPE
+    OBJECTS { serverName, serverStatus }
+    MAX-ACCESS  accessible-for-notify
+    STATUS	current
+    DESCRIPTION
+	"Server Starting"
+    ::= { apache2MIBNotifications 3 }
+
+serverStopNotification NOTIFICATION-TYPE
+    OBJECTS { serverName, serverStatus }
+    MAX-ACCESS  accessible-for-notify
+    STATUS	current
+    DESCRIPTION
+	"Server Shutting down"
+    ::= { apache2MIBNotifications 4 }
+      
+END
diff -ru -ruN net-snmp-5.4_orig/mibs/Makefile.in net-snmp-5.4/mibs/Makefile.in
--- net-snmp-5.4_orig/mibs/Makefile.in	2007-01-19 11:11:31.000000000 +0100
+++ net-snmp-5.4/mibs/Makefile.in	2007-01-19 11:11:31.000000000 +0100
@@ -23,7 +23,7 @@
 	SNMP-USER-BASED-SM-MIB.txt SNMP-VIEW-BASED-ACM-MIB.txt \
 	SNMP-COMMUNITY-MIB.txt TRANSPORT-ADDRESS-MIB.txt
 
-AGENTMIBS = AGENTX-MIB.txt SMUX-MIB.txt
+AGENTMIBS = AGENTX-MIB.txt APACHE2-MIB.txt SMUX-MIB.txt
 
 IANAMIBS = IANAifType-MIB.txt IANA-LANGUAGE-MIB.txt \
 	IANA-ADDRESS-FAMILY-NUMBERS-MIB.txt
diff -ru -ruN net-snmp-5.4_orig/mibs/Makefile.mib net-snmp-5.4/mibs/Makefile.mib
--- net-snmp-5.4_orig/mibs/Makefile.mib	2007-01-19 11:11:31.000000000 +0100
+++ net-snmp-5.4/mibs/Makefile.mib	2007-01-19 11:11:31.000000000 +0100
@@ -14,7 +14,7 @@
 	SNMP-FRAMEWORK-MIB.txt SNMP-MPD-MIB.txt SNMP-USER-BASED-SM-MIB.txt \
 	SNMP-VIEW-BASED-ACM-MIB.txt SNMP-COMMUNITY-MIB.txt \
 	SNMP-TARGET-MIB.txt SNMP-NOTIFICATION-MIB.txt SNMP-PROXY-MIB.txt \
-	AGENTX-MIB.txt SMUX-MIB.txt \
+	AGENTX-MIB.txt APACHE2-MIB.txt SMUX-MIB.txt \
 	DISMAN-SCRIPT-MIB.txt  DISMAN-SCHEDULE-MIB.txt \
 	IANA-LANGUAGE-MIB.txt IANA-ADDRESS-FAMILY-NUMBERS-MIB.txt \
 	IF-MIB.txt IF-INVERTED-STACK-MIB.txt \
@@ -79,7 +79,7 @@
 SNMPv2-MIB.txt:	$(MIBDEPS)
 	./mibfetch $(RFCHOST) $(RFCDIR) 3418
 
-AGENTX-MIB.txt:	$(MIBDEPS)
+AGENTX-MIB.txt APACHE2-MIB.txt:	$(MIBDEPS)
 	./mibfetch $(RFCHOST) $(RFCDIR) 2742
 
 SMUX-MIB.txt:	$(MIBDEPS)
